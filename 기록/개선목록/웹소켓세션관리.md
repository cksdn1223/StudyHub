# 웹소켓에서 세션 관리
채팅방에서 알림을 보낼대 채팅방에 들어온사람을 구별해서 알림 가게 하려고 한다.

누가 어떤 방에 들어와 있는지 서버 메모리에 저장하고
WebSocket에서 SUBSCRIBE / DISCONNECT 시점에 그 정보를 업데이트한다.

라는 방식으로 구현 해보면 된다고 해서 해보려고한다.

1. 방 접속 정보 저장 서비스 만들기
```java
@Service
public class ChatPresenceService {


    private final Map<Long, Set<Long>> roomUsers = new ConcurrentHashMap<>();

    public void enterRoom(Long studyId, Long userId) {
        roomUsers
                .computeIfAbsent(studyId, id -> ConcurrentHashMap.newKeySet())
                .add(userId);
    }

    public void leaveRoom(Long studyId, Long userId) {
        Set<Long> users = roomUsers.get(studyId);
        if (users != null) {
            users.remove(userId);
            if (users.isEmpty()) {
                roomUsers.remove(studyId);
            }
        }
    }

    public boolean isInRoom(Long studyId, Long userId) {
        Set<Long> users = roomUsers.get(studyId);
        return users != null && users.contains(userId);
    }
}
```

2. STOMP 메시지 가로채서 "입장/퇴장" 감지하기
`client.subscribe("/sub/message/" + studyId, ...)` 이런식으로 구독중
서버에서는 SUBSCRIBE, DISCONNECT 프레임을 intercept 해서 들어왔는 지나갔는지를 기록하면 된다고 한다.

 - 1. 인터셉터 클래스 만들기
  SUBSCRIBE 프레임에서 destination 파싱 → studyId 추출
  DISCONNECT 프레임에서 sessionId 기준으로 어떤 방이었는지 찾아서 leave
 - 2. WebSocket 설정에서 인터셉터 등록
  클라이언트가 /sub/message/{studyId} 구독하면
  → ChatPresenceService.enterRoom(studyId, userId) 호출
  WebSocket 끊기면
  → ChatPresenceService.leaveRoom(studyId, userId) 호출
