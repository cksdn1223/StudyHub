# 개선 내역
스터디 엔티티의 멤버 수를 수동으로 + - 해주는 메서드로 값을 변경해주고있었다.
```java
// 기존 필드 선언 방식
@Column(nullable = false)
private Integer memberCount;

// 변경 후 필드 선언 방식
@Formula("(select count(sp.user_id) + 1 from study_participant sp " +
        "where sp.study_id = id and sp.status = 'ACCEPTED')")
private Integer memberCount;
```

스터디 엔티티의 멤버 수 계산 방식은 `스터디를 만든 리더(1명) + 참여자(ACCEPTED상태)` 인데
매번 참여자를 수락하는 로직에서 스터디.memberCount를 ++ 해주고있었지만 이 방식은 언젠가 오류가 날 가능성이 있다 판단해
집계함수로 셀 수 있지 않을까 해서 찾아본 결과 `Formula 어노테이션`을 사용해 자동으로 계산한 결과를 넣어 줄 수 있는것을 알아냈다.

이렇게 사용하게 된다면 직접 add, reduce 같은 메서드를 만들어 사용하지 않아도 추가만 해준다면 알아서 계산이 되는것을 알 수 있었다.

결국 멤버수를 추가하는 로직에서 add, reduce 의 메서드를 지울 수 있었다.
추가로 멤버수를 계산하는 부분에서 나올 수 있는 오류의 경우의 수를 줄인것이 매우 만족스럽다.

---

```java
@OneToMany(mappedBy = "study", cascade = CascadeType.ALL, orphanRemoval = true)
@Where(clause = "status = 'ACCEPTED'")
private List<StudyParticipant> participants = new ArrayList<>();
```
>+ where 어노테이션으로 조건도 걸어줄 수 있다.