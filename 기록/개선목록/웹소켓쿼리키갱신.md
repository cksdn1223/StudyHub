# 웹소켓 쿼리 키 갱신
그 전에는 웹소켓으로 채팅을 보내면 저장 후 그 리스트들을 useQuery로 불러와서 목록을 보여준 후
웹소켓에서 메시지를 받았다는 신호가 오면
`queryClient.invalidateQueries(queryKey);` 방식으로 그냥 초기화를 시켜서 재랜더링 시키는 방식으로
채팅을 불러왔다.
-> 하지만 이런 방식을 사용하게 된다면 메시지 하나 올때마다 전체 리스트를 다시 요청하기 때문에
참여자 많고 메시지가 많으면 비효율적이라는것을 알게되어서 방식을 바꾸게 되었다.

```tsx
queryClient.setQueryData<ChatMessage[]>(
  ["chatMessages", studyId],
  (old) => (old ? [...old, newMessage] : [newMessage])
);
```
이렇게 사용하게 된다면 기존 캐시된 메시지 리스트에 받아온 새 메시지를 추가하는것이 가능해진다
처음 입장할때만 useChatmessage 가 Rest호출로 히스토리를 로딩하고 이후에는 새 메시지가 올 때마다 캐시에 바로 추가하고 리랜더링한다.