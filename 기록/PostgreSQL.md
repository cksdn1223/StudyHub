# PostgreSQL λ° PostGIS
[μ°Έκ³  λ§ν¬](https://foss4g.tistory.com/1859)

λ§ν¬ μ„¤λ…λ€λ΅ μ„¤μΉ

[λ°μ΄ν„°λ² μ΄μ¤ μƒμ„±](https://foss4g.tistory.com/1860)

λ§ν¬ μ°Έκ³ ν•΄ λ°μ΄ν„°λ² μ΄μ¤ μƒμ„±

---
## μ‚¬μ© μ΄μ 
**PostgreSQLμ— PostGIS ν™•μ¥μ„ μ‚¬μ©ν•λ©΄, λ³µμ΅ν• κ±°λ¦¬ κ³„μ‚° λ΅μ§μ„ κ°λ°μκ°€ μ• ν”λ¦¬μΌ€μ΄μ…(Spring Boot) μ½”λ“ λ‚΄μ—μ„ μ§¤ ν•„μ” μ—†μ΄ SQL λ¬Έ ν•λ‚λ΅ λ°μ΄ν„°λ² μ΄μ¤μ—κ² λ§΅κΈΈ μ μμµλ‹λ‹¤.**

μ΄κ²ƒμ΄ λ°”λ΅ PostGISλ¥Ό λ„μ…ν•λ” κ°€μ¥ ν° μ΄μ μ΄μ μ΄μ μ…λ‹λ‹¤.

-----

## 1\. β™οΈ λ°μ΄ν„°λ² μ΄μ¤κ°€ μ²λ¦¬ν•λ” λ΅μ§

Spring Boot μ„λ²„λ” λ‹¤μκ³Ό κ°™μ€ μ •λ³΄λ¥Ό λ°μ΄ν„°λ² μ΄μ¤μ— μ „λ‹¬ν•©λ‹λ‹¤.

1.  **κΈ°μ¤€ μ„μΉ:** μ‚¬μ©μ(κ²€μƒ‰μ)μ κ²½λ„ λ° μ„λ„ μΆν‘.
2.  **κ²€μƒ‰ λ°κ²½:** μ°Ύκ³  μ‹¶μ€ κ±°λ¦¬ (μ: 5,000m λλ” 5km).

λ°μ΄ν„°λ² μ΄μ¤λ” μ΄ μ •λ³΄λ¥Ό λ°›μ•„μ„ PostGISμ μ „μ© ν•¨μλ¥Ό μ‚¬μ©ν•΄ κ²€μƒ‰μ„ μ²λ¦¬ν•©λ‹λ‹¤.

### ν•µμ‹¬ PostGIS ν•¨μ: `ST_DWithin`

μ¤ν„°λ”” λ©λ΅μ„ κ²€μƒ‰ν•  λ• μ‚¬μ©ν•λ” ν•µμ‹¬μ μΈ SQL ν•¨μλ” `ST_DWithin`μ…λ‹λ‹¤.

```sql
SELECT *
FROM Study
WHERE ST_DWithin(
    Study.geom,            -- μ¤ν„°λ””μ μ„μΉ λ°μ΄ν„° (DBμ— μ €μ¥λ μΆν‘)
    ST_SetSRID(ST_MakePoint(:user_lon, :user_lat), 4326), -- μ‚¬μ©μ ν„μ¬ μ„μΉ
    :radius_in_meters      -- κ²€μƒ‰ λ°κ²½ (λ‹¨μ„: λ―Έν„°)
);
```

μ΄ ν•¨μλ” λ‹¤μ λ‘ κ°€μ§€ μ—­ν• μ„ λ™μ‹μ— μν–‰ν•©λ‹λ‹¤.

1.  **κ±°λ¦¬ κ³„μ‚°:** μ§€κµ¬μ κ³΅λ¥ μ„ κ³ λ ¤ν•μ—¬ `Study.geom`κ³Ό μ‚¬μ©μμ μ„μΉ μ‚¬μ΄μ **μ •ν™•ν• μ‹¤μ  κ±°λ¦¬**λ¥Ό κ³„μ‚°ν•©λ‹λ‹¤.
2.  **μ΅°κ±΄ ν•„ν„°λ§:** κ³„μ‚°λ κ±°λ¦¬κ°€ `:radius_in_meters` λ‚΄μ— ν¬ν•¨λλ”μ§€ ν™•μΈν•κ³ , ν•΄λ‹Ή μ¤ν„°λ””λ§ μ¦‰μ‹ λ°ν™ν•©λ‹λ‹¤.

μ΄ λ¨λ“  λ³µμ΅ν• κ³„μ‚°μ€ PostgreSQLμ \*\*κ³µκ°„ μΈλ±μ¤(Spatial Index)\*\*λ¥Ό ν†µν•΄ μ΄κ³ μ†μΌλ΅ μ²λ¦¬λ©λ‹λ‹¤.

## 2\. π’» Spring Bootμ μ—­ν• 

Spring Boot λ°±μ—”λ“ κ°λ°μ(Service Layer)μ μ—­ν• μ€ μ΄μ  **κ³„μ‚° λ΅μ§μ„ μ§λ” κ²ƒ**μ΄ μ•„λ‹λΌ, **SQL μΏΌλ¦¬λ¥Ό μ•μ „ν•κ³  ν¨μ¨μ μΌλ΅ λ§λ“λ” κ²ƒ**μΌλ΅ λ°”λ€λ‹λ‹¤.

  * **[QueryDSL](QueryDSL.md) μ‚¬μ©:** Spring Boot Serviceμ—μ„ μ‚¬μ©μμ κ²€μƒ‰ νλΌλ―Έν„°(μ„λ„, κ²½λ„, λ°κ²½)λ¥Ό λ°›μ•„ **QueryDSL**λ΅ μ„ SQLμ„ μ¶”μƒν™”ν•μ—¬ μ•μ „ν•κ² νΈμ¶ν•©λ‹λ‹¤.
  * **λ°μ΄ν„° λ³€ν™:** ν΄λΌμ΄μ–ΈνΈκ°€ μ „λ‹¬ν• μ„λ„/κ²½λ„(λ¬Έμμ—΄/μ«μ)λ¥Ό DBκ°€ μ΄ν•΄ν•  μ μλ” μΆν‘ νƒ€μ…μΌλ΅ λ³€ν™ν•μ—¬ μΏΌλ¦¬μ— λ°”μΈλ”©ν•©λ‹λ‹¤.

κ²°λ΅ μ μΌλ΅, λ΅μ§μ€ **SQL λ¬Έμ¥ ν•λ‚**λ΅ λλ‚©λ‹λ‹¤. κ°λ°μλ” λ³µμ΅ν• μν•™ κ³µμ‹ λ€μ‹  DBμ κ°•λ ¥ν• κΈ°λ¥μ„ ν™μ©ν•λ” λ° μ§‘μ¤‘ν•  μ μμµλ‹λ‹¤.